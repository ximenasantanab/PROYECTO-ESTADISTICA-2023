---
title: "R Notebook"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

**PROYECTO ESTADÍSTICA GRUPO 6**

| Nombre y Apellido | Código | Participación |
|:-----------------:|:------:|:-------------:|
|  Ximena Santana   |        |               |
|                   |        |               |

1.  **Tema**

    Análisis del servicio de alojamiento de Airbnb en nueve ciudades en Europa del 2023.

2.  **Objetivo general**

    Analizar del servicio de alojamiento de Airbnb en nueve ciudades en Europa del 2023. holaaa

3.  **Objetivos**

-   Analizar las ciudades con mejor ranking (ELABORAMOS NUESTRO PROPIO RANKING)de experiencia de Airbnb en Europa del 2023.

-   Describir las características de los alojamientos más caros y más económicos en ciudades de Europa del 2023.

-   Analizar la atracción de un Airbnb y su relación con su ubicación en ciudades de Europa del 2023.

3.  **Planificación : realizar un diagrama de Gantt hasta la semana 15. (FALTA)**

4.  **Instrumento de recolección**

-   Acceso a data de fuente secundaria ( 41,714 observaciones: Datos sobre los AIRBNB de 9 ciudades famosas de Europa, Amsterdam, Athens, Barcelona, Berlin, Budapest, Lisbon, Paris, Rome and Vienna. )

    <https://www.kaggle.com/datasets/dipeshkhemani/airbnb-cleaned-europe-dataset?group=bookmarked>

    <https://drive.google.com/file/d/1I1u893jIu2HbdGp-ljNbc6_ANqmrJ2Xq/view?usp=share_link>

-   Clasificación de variables

    | N°  |          Variable           |         Tipo         |
    |:---:|:---------------------------:|:--------------------:|
    |  1  |            City             | (Categórica nominal) |
    |  2  |     Cuándo lo reservan      | (Categórica nominal) |
    |  3  |          Room Type          | (Categórica nominal) |
    |  4  |         Shared Room         | (Categórica nominal) |
    |  5  |        Private Room         | (Categórica nominal) |
    |  6  |          Superhost          | (Categórica nominal) |
    |  7  |       Multiple Rooms        | (Categórica nominal) |
    |  8  |     Cleanliness Rating      | (Categórica ordinal) |
    |  9  |     Guest Satisfaction      | (Categórica ordinal) |
    | 10  |     Business (ofertas)      | (Categórica nominal) |
    | 11  |       Person Capacity       | (Numérica discreta)  |
    | 12  |            Price            | (Numérica continua)  |
    | 13  |          Bedrooms           | (Numérica discreta)  |
    | 14  |      City Center (km)       | (Numérica continua)  |
    | 15  |     Metro Distance (km)     | (Numérica continua)  |
    | 16  | Normalised attraction Index | (Numérica continua)  |
    | 17  | Normalised restaurant index | (Numérica continua)  |

3.  **Lectura de base de datos**

```{r}
library(readr)
library(dplyr)
library(ggplot2)
D <- read_csv("Aemf1.csv") #EL ARCHIVO Aemf1 y datos.AIRBNB es lo mismo. 
coef_var <- function(x, na.rm = FALSE) {sd(x, na.rm=na.rm) / mean(x, na.rm=na.rm)}
#coef_var()

roundF <- function(x){return(round(x,digits = 2))}


#moda <- function(x) {return(as.character(names(which.max(table(DF$Barco)))))} 

```

Número de Observaciones y Variables

```{r}
nrow(D)
ncol(D)
```

-   Eliminamos la columna 18 y 16, ya que de esas variables usamos sólo sus valores normalizados.

```{r}
View(D) 

D$`Attraction Index` <- NULL
D$`Restraunt Index` <- NULL

```

-   Re asignación de nombres :

```{r}
names(D)
```

```{r}
D %>% rename( Tipo = `Room Type` , Capacidad = `Person Capacity`, Oferta = Business, Habitaciones = Bedrooms, Ind.Atraccion = `Normalised Attraction Index`, Precio = Price, Share_Room = `Shared Room`, Limpieza = `Cleanliness Rating`, Ind.Restaurantes = `Normalised Restraunt Index`, Satisfaccion = `Guest Satisfaction`, Ciudad = City, Private_Room = `Private Room`, Distance_Center = `City Center (km)`, Distance_Metro = `Metro Distance (km)`) -> D2

View(D2)
```

```{r}
names(D2)
```

-   Búsqueda de NA's y comprobación de casos completos

```{r}
Total_de_NAs <- sum(is.na(D))
print(paste("El total de NAs es :", Total_de_NAs)) 

Observaciones_completas <- sum(complete.cases(D2))
print(paste("Observaciones completas es : ",Observaciones_completas ))
Observaciones_incompletas <- sum(!complete.cases(D2))
print(paste("Observaciones incompletas es : ", Observaciones_incompletas))
```

## Limpieza de Datos

#### Verificar Variables booleanas

El primer paso para la limpieza de datos es hacer un resumen de los datos que se tienen.

```{r}
summary(D2)
```

-   **Multiple Rooms, Shared Room, Private Room y Oferta :** En primer lugar, se observa que Multiple rooms tiene como valor mínimo 0 y como valor máximo 1; esto mismo ocurre en el caso de la variable Oferta. Procedemos a analizar qué valores se encuentran dentro de estas dos variables.

```{r}
par(mfrow=c(1,2))

counts <- table(D2$`Multiple Rooms`)
barplot(counts, main = "Multiple Rooms", ylab = "Número de Observaciones", xlab = "Valores" , ylim = c(0,35000))

```

```{r}
counts <- table(D2$Oferta)
barplot(counts, main = "Oferta", ylab = "Número de Observaciones", xlab = "Valores" , ylim = c(0,30000), xlim = c(0,2) )
```

Como se observa, ambas variables cuentan solamente con "0" y "1" como valores, por lo que se trata de variables booleanas. Se observa que, además de estas dos variables, se tiene que Share_Room, Private_Room y Superhost también son variables de tipo bool. Para facilitar las operaciones futuras, se procederá a cambiar los "0" y "False" a la cadena "No", y los "1" y "True" a la cadena "Sí".

```{r}
vec <- factor(D2$Oferta, labels = c('No','Sí'))
D2$Oferta <- vec
vec <- factor(D2$`Multiple Rooms`, labels = c('No','Sí'))
D2$`Multiple Rooms` <- vec
vec <- factor(D2$Share_Room, labels = c('No','Sí'))
D2$Share_Room <- vec
vec <- factor(D2$Private_Room, labels = c('No','Sí'))
D2$Private_Room <- vec
vec <- factor(D2$Superhost, labels = c('No','Sí'))
D2$Superhost <- vec
```

A continuación, se hace nuevamente un resumen para verificar los cambios realizados a las variables.

```{r}
summary(D2)
```

#### Verificar variables númericas enteras:

-   **Capacidad y Habitaciones :** A continuación se verificará que la variable Capacidad contenga solamente números enteros, ya que un airbnb no puede tener capacidad para un número no entero de personas.El mismo análisis se realizará para la variable Habitaciones, ya que sucede lo mismo con esta variable.

```{r}
par(mfrow=c(1,2))
counts <- table(D2$Capacidad)
barplot(counts, main = "Capacidad", ylab = "Número de Observaciones", xlab = "Valores" , ylim = c(0,20000))
counts <- table(D2$Habitaciones)
barplot(counts, main = "Habitaciones", ylab = "Número de Observaciones", xlab = "Valores" , ylim = c(0,30000))
```

Se observa que ambas variables cumplen con los criterios previamente mencionados. Sin embargo, se observa que la variable habitaciones tiene algunos casos con valor 0. A continuación se analizarán estos casos; para ello, se filtrarán las filas que tienen 0 habitaciones.

```{r}
filter(D2, Habitaciones==0)
```

Se observa que no hay ningún patrón o algo que indique por qué estos airbnb tienen 0 habitaciones. Como no se tiene evidencia para sustentar que un airbnb pueda tener 0 habitaciones, se procederá a colocar NA's en las filas donde se encuentran los airbnb con 0 habitaciones.

```{r}
D2$Habitaciones <- replace(D2$Habitaciones, D2$Habitaciones==0, NA)
```

A continuación, se verificará que los valores de Habitaciones se hayan reemplazado correctamente.

```{r}
counts <- table(D2$Habitaciones)
barplot(counts, main = "Habitaciones", ylab = "Número de Observaciones", xlab = "Valores" , ylim = c(0,30000))
```

Se observa que ya no existen filas con airbnb's de 0 habitaciones.

El siguiente paso es verificar las variables Limpieza y Satisfacción. Estas variables corresponden a las puntuaciones dejadas por los usuarios de los airbnb's. Normalmente estas puntuaciones son números enteros, para verificar que esto se cumpla, se analizarán estas variables.

```{r}
counts <- table(D2$Limpieza)
barplot(counts, main = "Limpieza", ylab = "Número de Observaciones", xlab = "Valores" , ylim = c(0,20000))
```

```{r}
table(D2$Satisfaccion)
```

Se observa que la variable Limpieza tiene solamente números enteros en el rango 2-10 y la variable Satisfacción también, pero en el rango 20-100.

#### Verificando variables númericas no enteras

Para verificar las variables numéricas no enteras, se realizará nuevamente un resumen de las variables dentro del DataSet.

```{r}
summary(D2)


```

-   **Precio, City Center, Metro distance , Attraction y Restaurants Normalized :** De este resumen, se puede observar que el Indice de Atracción normalizado y el Índice de Restaurantes normalizado se encuentran dentro del rango establecido (0-100). Por otro lado, también se tienen a las variables Precio, City Center y Metro Distance. Se observa que los valores máximos se alejan considerablemente de la media. Por este motivo, se procederá a analizar cada una de estas variables.

```{r}
plot(D2$Precio, xlab= "Airbnb's" , ylab = "Precio")
```

Se observa que hay muy pocos casos por encima de 10000 dólares, a continuación se filtrará las filas que tienen un precio mayor a 10000 USD.

```{r}
filter(D2, Precio>10000)
```

Después de revisar los datos actuales en Airbnb a través de su aplicación, se encontró que, actualmente, hay 405 alojamientos en Atenas, más de 1000 en París, 168 en Vienna que tienen precios por encima de los 10000 USD. Por este motivo, estos datos se continuarán considerando dentro del dataset.

A continuación se analizará la variable Distance_Center, que representa la distancia al centro de del airbnb.

```{r}
plot(D2$Distance_Center, xlab= "Airbnb's" , ylab = "Distance to City Center (km)")
```

Se observa que son pocos los airbnb's que tienen una distancia al centro por encima de 15 Km, se procederá a filtrar las filas según esta condición.

```{r}
filter(D2, Distance_Center>15)
```

A continuación se analizarán en qué ciudades se encuentran estos airbnb's.

```{r}
unique(filter(D2, Distance_Center>15)[,'Ciudad'])
```

Se observa que estos airbnb's se ubican en Berlin o Budapest. El área de estas ciudades es de 891.2 km^2^ y 525.2 km^2^, respectivamente. Debido a esto, es posible que existan airbnb's que se encuentren a 15 km o más de distancia del centro.

A continuación se analizará la variable Distance_Metro, que representa la distancia a la estación de metro más cercana al airbnb.

```{r}
plot(D2$Distance_Metro, xlab= "Airbnb's" , ylab = "Distance to Metro Station (km)")
```

Se filtrarán los airbnb's con distancia mayor a 8km, ya que se observa que no son muchos en la gráfica.

```{r}
filter(D2, Distance_Metro>8)
```

A continuación se analizarán en qué ciudades se encuentran estos airbnb's.

```{r}
unique(filter(D2, Distance_Metro>8)[,'Ciudad'])
```

Nuevamente, se observa que las ciudades son Berlín y Budapest, que son ciudades bastante grandes como se mencionó en el punto anterior. Por este motivo, se considerarán como datos válidos.

#### Verificando variables de tipo character

Por último se procederá a analizar las variables Ciudad, Día y Tipo; estas son catalogadas por R como variables de tipo char. Para el caso, de la variable Ciudad, deberían haber 9 valores distintos, que representen las 9 ciudades a las que pertenece la data.

```{r}
unique(D2$Ciudad)
unique(D2$Tipo)
unique(D2$Day)
counts <- table(D2$Ciudad)
barplot(counts, main = "Ciudad", ylab = "Número de Observaciones" , las=2, ylim = c(0,10000), cex.names = 0.9)
```

Una vez comprobado que solamente existen 9 ciudades en el Dataframe, se procede a revisar el Día y Tipo de airbnb.

```{r}
par(mfrow=c(1,2)) #QUE HACE mfrow ?
counts <- table(D2$Day)
barplot(counts, main = "Día", ylab = "Número de Observaciones", las = 2, ylim = c(0,25000), cex.axis = 0.8, cex.lab = 0.7, cex.names = 0.6)
counts <- table(D2$Tipo)
barplot(counts, main = "Tipo", ylab = "Número de Observaciones", las = 2, ylim = c(0,30000), cex.axis = 0.8, cex.names = 0.6, cex.lab = 0.7)
```

Se observa que tampoco existen anomalías en estas variables, por lo que podemos concluir que nuestra data se encuentra en condiciones de ser utilizada para los análisis posteriores.

## 1. Análisis Univariado : (Edwin)

```{r}

##
## SATISFACCIÓN
##
par(mfrow=c(1,2)) #QUE HACE mfrow ?
boxplot(D2$Satisfaccion, main = "Satisfaccion", xlab = "Puntaje de Satisfaccion", ylab = "Frecuencia")
# Add mean as a red point
points(mean(D2$Satisfaccion), col = "red", pch = 16)
# Add median as a blue point
points(median(D2$Satisfaccion), col = "blue", pch = 16)
hist(D2$Satisfaccion, main = "Satisfaccion", xlab = "Puntaje de Satisfaccion", ylab = "Frecuencia")
mean_satisfaction <- mean(D2$Satisfaccion)
median_satisfaction <- median(D2$Satisfaccion)
# Add mean as a red dashed line
abline(v = mean_satisfaction, col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median_satisfaction, col = "blue", lwd = 2)
```
```{r}
mean_satisfaction
median_satisfaction
IQR(D2$Satisfaccion)
quantile(D2$Satisfaccion) 
```
En el caso de la variable Satisfacción, en las gráficas se observa que la media y la mediana son valores entre 90 y 100. En el caso del boxplot de la variable satisfacción, se observa de manera gráfica los rangos entre los cuáles se encuentra la variable Satisfacción y cuál es la distribución de estos. La media de esta variable es 93.10, mientras que la mediana es 95; además, el 75% de los valores de satisfacción son mayores a 90. Por estos motivos, se puede afirmar que la satisfacción de los consumidores de airbnb en estas 9 ciudades es bastante alta, en promedio.


```{r}
##
## LIMPIEZA
##
mean_limpieza <- mean(D2$Limpieza)
median_limpieza <- median(D2$Limpieza)
boxplot(D2$Limpieza, main = "Limpieza", xlab = "Puntaje de Limpieza", ylab = "Frecuencia")
# Add mean as a red point
points(mean_limpieza, col = "red", pch = 16)
# Add median as a blue point
points(median_limpieza, col = "blue", pch = 16)
```
```{r}
mean_limpieza
median_limpieza
IQR(D2$Limpieza)
quantile(D2$Limpieza) 
```

Como se mencionó, anteriormente, la variable Limpieza solo toma valores enteros entre 1 a 10. En el gráfico se observa que la mayoría de valores se concentra en entre 9 y 10; también que la media y la mediana se encuentran en esta zona. Además, de los datos anteriores se aprecia que más del 75% de los valores se encuentran entre 9 y 10; por esto tiene bastante sentido que la media y mediana sean valores cercanos a 9 y 10. La media de esta variable es 9.44 y la mediana es 10; por ello se puede afirmar que los puntajes de limpieza de los airbnbs son bastante altos, en promedio.

```{r}
##
## ATRACCIÓN
##
mean_atraccion <- mean(D2$Ind.Atraccion)
median_atraccion <- median(D2$Ind.Atraccion)
par(mfrow=c(1,2)) #QUE HACE mfrow ?
boxplot(D2$Ind.Atraccion, main = "Atracción", xlab = "Índice de Atracción", ylab = "Frecuencia")
# Add mean as a red point
points(mean_atraccion, col = "red", pch = 16)
# Add median as a blue point
points(median_atraccion, col = "blue", pch = 16)
hist(D2$Ind.Atraccion, main = "Atracción", xlab = "Índice de Atracción", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean_atraccion, col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median_atraccion, col = "blue", lwd = 2)
```
```{r}
mean_atraccion
median_atraccion
IQR(D2$Ind.Atraccion)
quantile(D2$Ind.Atraccion) 
```
El índice de atracción se encuentra normalizado, por lo que los valores que puede tomar son del 1 al 100. En las gráficas se puede observar que la mayoría de valores se encuentran por debajo de 20, y que la media y la mediana son valores cercanos a 10. En los valores obtenidos se aprecia que más del 50% de los datos es menor a 10 y el 75% de los datos son menores a 15.47. Con esta información, se puede afirmar que la mayoría de valores son bajos para el índice de atracción.


```{r}
#SUPERHOST
plot(x = D2$Superhost, main = "Gráfica de Superhost",
     xlab = "Superhost", ylab = "Frecuencia")
```

```{r}
#
##CIUDADES
#
ggplot(data= D2, mapping=aes(x=Ciudad))+ geom_bar()+ theme_grey()+ labs(title="Gráfica de ciudades",x="Ciudades",y="Frecuencias")
```


```{r}
#DÍA DE LA SEMANA
ggplot(data= D2, mapping=aes(x=Day))+ geom_bar()+ theme_grey()+ labs(title="Gráfica de días de la semana",x="Días",y="Frecuencias")

```

```{r}
#CAPACIDAD

mean_capacidad <- mean(D2$Capacidad)
median_capacidad <- median(D2$Capacidad)
par(mfrow=c(1,2)) 
boxplot(D2$Ind.Atraccion, main = "Capacidad", xlab = "Capacidad", ylab = "Frecuencia")
# Add mean as a red point
points(mean_atraccion, col = "red", pch = 16)
# Add median as a blue point
points(median_atraccion, col = "blue", pch = 16)
hist(D2$Capacidad, main = "Capacidad", xlab = "Capacidad", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean_capacidad, col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median_capacidad, col = "blue", lwd = 2)
```
```{r}
#
##Tipo
#
ggplot(data= D2, mapping=aes(x=Tipo))+ geom_bar()+ theme_grey()+ labs(title="Gráfica de tipos de habitaciones",x="Tipo",y="Frecuencias")

```
```{r}
#
##Share room
#
ggplot(data= D2, mapping=aes(x=Share_Room))+ geom_bar()+ theme_grey()+ labs(title="Gráfica de habitaciones compartidas",x="Share rooms",y="Frecuencias")
```

```{r}
#
## Multiple rooms
#

```



Analizamos las variables por separado de nuestra variables más relevantes

=======
```{r}

```


D2 %>% select(Ciudad, Precio) -> ciudad_precio_boxplot
ciudad_precio_boxplot
#seleccionamos por ciudades : 
# 1. AMS
ciudad_precio_boxplot %>% filter(ciudad_precio_boxplot$Ciudad == 'Amsterdam') -> boxAMS
>>>>>>> ee82b149503d65b882e0bb7ba342686c864289cf

boxplot(boxAMS$Precio, ylim = c (0,5000), main = ' Escalas modificadas ')

```

### 2. Análisis Bivariado :

### 3. Análisis Descriptivo : "NUESTRA BASE DE DATOS FINAL ES D2"

\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

### Objetivo 1 :Analizar las ciudades con mejor ranking de experiencia de Airbnb en Europa del 2023.

1. Promedio de satisfacción, promedio de precio, número de superhost, número de airbnbs, promedio de puntaje de limpieza, promedio de índice de atracción por ciudad.
```{r}
D2 %>% 
  group_by(Ciudad) %>% 
  summarise(`Precio Promedio` = mean(Precio),
            `Número de Airbnb's` = n(),
            `Satisfaccion Promedio` = mean(Satisfaccion), 
            `Superhosts %` = prop.table(table(Superhost))["Sí"],
            `Puntaje de Limpieza Promedio` = mean(Limpieza),
            `Índice de Atracción Promedio` = mean(Ind.Atraccion)) -> D_Ciudades
arrange(D_Ciudades)

```
```{r}
D2 %>% filter(Ciudad =='Amsterdam') -> DAMS
D2 %>% filter(Ciudad =='Barcelona') -> DBAR
D2 %>% filter(Ciudad =='Athens') -> DATH
D2 %>% filter(Ciudad =='Berlin') -> DBER
D2 %>% filter(Ciudad =='Budapest') -> DBUD
D2 %>% filter(Ciudad =='Lisbon') -> DLIS
D2 %>% filter(Ciudad =='Paris') -> DPAR
D2 %>% filter(Ciudad =='Rome') -> DROM
D2 %>% filter(Ciudad =='Vienna') -> DVIE


par(mfrow=c(3,3))

hist(DAMS$Precio, main = "Precio en Amsterdam", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DAMS$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DAMS$Precio), col = "blue", lwd = 2)

hist(DBAR$Precio, main = "Precio en Barcelona", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DBAR$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DBAR$Precio), col = "blue", lwd = 2)

hist(DATH$Precio, main = "Precio en Atenas", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DATH$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DATH$Precio), col = "blue", lwd = 2)

hist(DBER$Precio, main = "Precio en Berlin", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DBER$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DBER$Precio), col = "blue", lwd = 2)

hist(DBUD$Precio, main = "Precio en Budapest", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DBUD$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DBUD$Precio), col = "blue", lwd = 2)

hist(DLIS$Precio, main = "Precio en Lisboa", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DLIS$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DLIS$Precio), col = "blue", lwd = 2)

hist(DPAR$Precio, main = "Precio en Paris", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DPAR$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DPAR$Precio), col = "blue", lwd = 2)

hist(DROM$Precio, main = "Precio en Roma", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DROM$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DROM$Precio), col = "blue", lwd = 2)

hist(DVIE$Precio, main = "Precio en Vienna", xlab = "Precio", ylab = "Frecuencia")
# Add mean as a red dashed line
abline(v = mean(DVIE$Precio), col = "red", lwd = 2)
# Add median as a blue dashed line
abline(v = median(DVIE$Precio), col = "blue", lwd = 2)
```



2. Índice de satisfacción VS Precio
```{r}
plot(x = D2$Satisfaccion, y = D2$Precio, xlab = "Satisfacción" , ylab = "Precio", ylim= c(0,2500))
```
```{r}
cor(D2$Satisfaccion, D2$Precio)
```
Del gráfico se puede observar que la correlación entre ambas variables es muy baja. Después de hallar el valor de la correlación, se comprueba esta observación, ya que su valor es de 0.016.

3. Gráfica de Limpieza VS Precio
```{r}
plot(x = D2$Limpieza, y = D2$Precio, xlab = "Puntaje de Limpieza" , ylab = "Precio", ylim = c(0,5000))
```
```{r}
cor(D2$Limpieza, D2$Precio)
```
En este otro caso, también se puede observar que la correlación entre ambas variables es baja. Después de hallar el valor de la correlación, se comprueba esta observación, ya que su valor es de 0.004.

4. Gráfica de Atracción normalizada VS Precio
```{r}
plot(x = D2$Ind.Atraccion, y = D2$Precio, xlab = "Índice de Atracción" , ylab = "Precio", ylim= c(0,2500))
```
```{r}
cor(D2$Ind.Atraccion, D2$Precio)
```
Del gráfico se puede observar que la correlación entre ambas variables es baja. Después de hallar el valor de la correlación, se comprueba esta observación, ya que su valor es de 0.271.

5. Gráfica de Limpieza vs Satisfacción
```{r}
plot(x = D2$Limpieza, y = D2$Satisfaccion, xlab = "Satisfacción" , ylab = "Puntaje de Limpieza", ylim= c(0,100))
```
```{r}
cor(D2$Satisfaccion, D2$Limpieza)
```
De la gráfica se obnserva que puede existir cierta correlación entre ambas variables y, al calcular esta correlación, se encuentra que el valor es de 0.69, por lo que se puede afirmar que existe una correlación media entre ambas variables.


6. Gráfica de Ciudad VS Cuándo se reserva
```{r}
mosaicplot(table(D2$Ciudad, D2$Day), main = "Cuándo se reserva - Ciudad", xlab = "Ciudades", ylab = "Cuándo se Reserva", las = 0.7, )
```




\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_

### Objetivo 2 : Describir las características de los alojamientos más caros y más económicos en ciudades de Europa del 2023.

1.  Conocer el total de las ciudades que pertenecen a la base de datos
2.  Conocer el precio promedio de los alojamientos en las 9 ciudades
3.  Conocer la mediana del precio de los alojamientos
4.  Identificar cuáles son las observaciones que se encuentran por debajo de la mediana : "ECO"
5.  Identificar cuáles son las observaciones que se encuentran por arriba de la mediana : "CARO"
6.  De la mitad mayor a la mediana, identificar la moda de Superhost y Room Type
7.  Conocer el precio más económico y sus características
8.  Identificar el tipo de cuarto de las habitaciones más económicas
9.  Conocer el precio más caro e identificar sus características
10. Identificar el tipo de cuarto de las habitaciones más caras
11. Conocer el precio más caro e identificar sus características
12. Analizar por ciudades las características del alojamiento más caro y económico, analizar la relación precio y ubicación, analizar la relación precio e indice de restaurantes y atracción.

### Desarrollo :

-   Conocer el total de las ciudades que pertenecen a la base de datos

```{r}
unique(D2$Ciudad)
c <- table(D2$Ciudad)
sum(c)
barplot(c, main = "Ciudades en el Estudio", ylab = "Número de Observaciones" , las=2, ylim = c(0,10000), cex.names = 0.9, col=c("orange"))


```

*La mayor cantidad de alojamientos de todo el estudio se encuentran en Roma.*

-   El precio promedio en todas las ciudades de Europa: Se realiza un boxplot para cada ciudad.

    ```{r}
    s <-round(mean(D2$Precio),digits = 2)
    s

    ```

*El precio de los alojamientos se encuentran alrededor de los 260 dólares.*

-   Conocer la mediana del precio de los alojamientos

    ```{r}
    mediana_precio <- median(D2$Precio)
    mediana_precio
    ```

*Se concluye que la mitad de los alojamientos de todas las ciudades son mayores a este valor, por lo tanto se les considera cómo la mitad con precios más caros. La parte inferior se consideran cómo económicos.*

*Al analizar estos 2 descriptores para la variable precio, se observa que la media es mayor a la mediana (se puede incluir un histograma y ver su sesgo)*

-   Identificar cuáles son las observaciones que se encuentran por arriba de la mediana : "CARO"

Filtramos la mitad superior a la mediana

```{r}
D2 %>% filter(Precio > mediana_precio) %>% arrange(desc(Precio)) -> CAROS
CAROS
nrow(CAROS) #Es el total de Airbnb con precios mayores a los 203.8193 (mediana)


```

Encontramos las cuidad

```{r}
c1 <- table(CAROS$Ciudad) #Del grupos de los Caros, Atenas es el que menos alojamientos tiene en el estudio (795). El de más apariciones es París (5,724)
c1
min(c1)
which.min(c1)

```

```{r}
#Analizamos el lado de  los 100 alojamientos más caros : 

CAROS[1:100, ] -> CAROS100 
CAROS100

#Qué ciudad aparece más aquí en alojamientos caros : 
ciudades_100 <- table(CAROS100$Ciudad)
barplot(ciudades_100)

superhost100 <- table(CAROS100$Superhost)
barplot(superhost100)

#Los valores de Limpieza y Satisfacción son muy altos
"La calificación que le asignan a este tipo de alojaminetos es 9.5 en promedio en LIMPIEZA"
mean(CAROS100$Limpieza) 
"La Satisfacción del servicio es una notación alta, ya que tiene un 95.19 en promedio"
mean(CAROS100$Satisfaccion)
"Y lo mínimo en satisfacción es 60, lo que igual es alto"
min(CAROS100$Satisfaccion)


```

```{r}

## Analizamos el tipo de cuarto y cuando lo suelen tomar por alquilado  : La mayoría es una Casa Entera
tipo_capacidad <- table(CAROS100$Tipo,CAROS100$Capacidad)

mosaicplot(tipo_capacidad)
```

```{r}
"La cantidad promedio de habitaciones en este tipo de alojamientos es:"
roundF(mean(CAROS100$Habitaciones, na.rm = T))

day <- table(CAROS100$Day) # Y se suelen tomar los fines de semana
mosaicplot(day)
```

*Analizando los a los 100 más económicos*

```{r}
D2 %>% filter(Precio < mediana_precio) %>% arrange(Precio)-> ECO
ECO
nrow(ECO) #Es el total de Airbnb con precios menores a los 203.8193 (mediana) son ...20,856
```

```{r}
#Analizamos el lado de  los 100 alojamientos más Económicos : 

ECO[1:100, ] -> ECO100 
ECO100

#Qué ciudad aparece más aquí en alojamientos caros : 
ciudadeseco_100 <- table(ECO100$Ciudad)
barplot(ciudadeseco_100)

Esuperhost100 <- table(ECO100$Superhost)
barplot(Esuperhost100)

#Los valores de Limpieza y Satisfacción son muy altos
"La calificación que le asignan a este tipo de alojaminetos es 8.9  en promedio en LIMPIEZA DEL 0-10"
mean(ECO100$Limpieza) 
"La Satisfacción del servicio es una notación alta, ya que tiene un 95.19 en promedio"
mean(ECO100$Satisfaccion)
"Y lo mínimo en satisfacción es 20, lo que igual es BAJO"
min(ECO100$Satisfaccion)
```

```{r}
## Analizamos el tipo de cuarto y cuando lo suelen tomar por alquilado  : La mayoría es una Habitación privada con baño.
tipo_capacidadECO <- table(ECO100$Tipo,ECO100$Capacidad)

mosaicplot(tipo_capacidadECO)
```

```{r}
"La cantidad promedio de habitaciones en este tipo de alojamientos es:1 ,el espacio es reducido"
roundF(mean(ECO100$Habitaciones, na.rm = T))

dayeco <- table(ECO100$Day) # Y se suelen tomar tanto en día de semana cómo para fines.
mosaicplot(dayeco)
```

*Del grupo de los más caros Athenas es la ciudad que tiene menos apariciones, por lo que se concluye que en esta ciudad sus precios de sus alojamientos son aún menores que 203.*

-   Identificar cuáles son las observaciones que se encuentran por debajo de la mediana : "ECO"

    ```{r}

    D2 %>% filter(Precio < mediana_precio)%>% arrange(Precio) -> ECO
    ECO
    nrow(ECO)



    ```

    ```{r}
    ECO %>% filter(ECO$Superhost == 'Sí')

    ```

*Aqui se comprueba que Athenas es uns de las cuidades con precios más económicos en el estudio. Asimismo, tambien podemos encontrar a Roma con esta característca de precios económicos. Sin embargo tambien tenía considerables observaciones en dentro de los más caros, por lo tanto esta ciudad ofrece una amplia oferta con respecto a los precios.*

```{r}
ECO %>% filter(ECO$Superhost == 'Sí' )
```

-   De la mitad mayor a la mediana, identificar la moda de Superhost y Room Type

    ```{r}
    S <- table(CAROS$Superhost)
    S
    barplot(S,col=c("orange","blue"),
            legend.text=c("Sí","No"),main="SUPERHOST")
    ```

-   Identificar los 5 más caros y analizar sus similaridades.

-   Cuánto es el % de Airbnb con precios mayores al promedio que se encuentran en cada una de las ciudades :

    ```{r}
    D2 %>% filter(Precio > s)%>% arrange(Precio) -> DD2
    DD2
    C <- table(DD2$Ciudad) # En amsterdam está la mayoría de Airbnbs que su precio es mayor al promedio
    C 
    # OPCIÓN 1 
    barplot(C)
    ```

-   Cuál es la ciudad que tiene mayor puntaje de Satisfaccion :

    ```{r}
    # La ciudad que más aparece aquí es  : 

    DD2 %>% select(Ciudad,Satisfaccion)%>%group_by(Ciudad)%>%summarise(Satisfaccion=sum(Satisfaccion)) %>%arrange(desc(Satisfaccion))%>%tail(n=-1) -> X2

    X2


    ```

    ```{r}
    barplot(X2$Satisfaccion, ylim = c(0,200000))
    ```

-   Dónde se encuentra el Airbnb más caro y más económico, y qué características tienen :

    El alineamiento más caro se encuentra en Athenas con un precio de 18,545.45 mil dólares, lo que implica una "Casa entera", así mismo este tiene altas calificaciones tanto en limpeza y satisfacción. Además la cercanía a las ciudades es buena (es cercano a ellas)

    ```{r}
    max(D2$Precio)
    a <- which.max(D2$Precio)
    D2[a,1:17]

    ```

    ```{r}
    round(min(D2$Precio),digits = 2)
    a2 <- which.min(D2$Precio)
    D2[a2,1:17]

    ```

## Relación entre variables por ciudades :
Aquí se analiza por ciudades por separado y se ve la relación precio vs (ubicación, restaurantes)

```{r}
unique(D2$Ciudad)
```

### Amsterdam

Aquí filtramos a todos los alojamientos ubicados en Amsterdam y analizamos si existe una relación de precio con respecto a su ubicación al metro, al centro de la ciudad y su índice de restaurantes:

```{r}
#Filtramos
D2 %>% filter(Ciudad =='Amsterdam') -> DAMSTERDAM
DAMSTERDAM

#El más caro
r1 <- which.max(DAMSTERDAM$Precio)
DAMSTERDAM[r1,1:17]


#El más económico
r2 <- which.min(DAMSTERDAM$Precio)
DAMSTERDAM[r2,1:17]

#Relación precio vs metro(km)

plot(DAMSTERDAM$Precio ~ DAMSTERDAM$Distance_Metro, main = 'Variación del precio vs la distancia al metro')
abline(lm(DAMSTERDAM$Precio ~ DAMSTERDAM$Distance_Metro), col = "red", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DAMSTERDAM$Distance_Metro, DAMSTERDAM$Precio), 2)), x = 4, y = 7000)

#Relación precio vs centro(km)
plot(DAMSTERDAM$Precio ~ DAMSTERDAM$Distance_Center, main = 'Variación del precio vs la distancia al centro')
abline(lm(DAMSTERDAM$Precio ~ DAMSTERDAM$Distance_Center), col = "green", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DAMSTERDAM$Distance_Center, DAMSTERDAM$Precio), 2)), x = 10, y = 7000)


#Relación precio vs indice de restaurantes
plot(DAMSTERDAM$Precio ~ DAMSTERDAM$Ind.Restaurantes, main = 'Variación del precio vs Índice de restaurantes', colors())
abline(lm(DAMSTERDAM$Precio ~ DAMSTERDAM$Ind.Restaurantes), col = "pink", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DAMSTERDAM$Ind.Restaurantes, DAMSTERDAM$Precio), 2)), x = 80, y = 7000)
```


#-----------------------------------------------------------------------------------------------------------
CONSULTAR URGENTE !
De los Airbnb que pertenecen a Amsterdam, separamos los rangos de precios e identificamos dónde es que se encuentra la mayoría : (Histograma)

```{r}
hist(table(DAMSTERDAM$Precio), breaks = 5)

curve(dnorm, add=TRUE, col="red", lwd=2)
```


# ---------------------------------------------------------------------------------------------------------


#PARA VER SI ESTOS DOS TIENEN RELACIÓN SE CALCULA COR Y SU COVARIANZA
Cálculo de correlación

```{r}

# Hallamos la correlación entre precio y distancia al metro. la correlación está entre -1.....0....   1 . Mientras más cerca al cero es que la correlación es baja.

cor(DAMS$Precio,DAMS$Distance_Metro)


regresion2 <- lm(Distance_Center ~ Precio , data = DAMS)
summary(regresion2)
plot(DAMS$Precio,DAMS$Distance_Center, xlab='Precio', ylab='Distancia al Centro(km)')
abline(regresion2)
```



## Realizamos este análisis para el conjunto total de ciudade en el estudio :
```{r}


#Relación precio vs metro(km)
plot(D2$Precio ~ D2$Distance_Metro, main = 'Variación del precio vs la distancia al metro')
abline(lm(D2$Precio ~ D2$Distance_Metro), col = "red", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(D2$Distance_Metro, D2$Precio), 2)), x = 11, y = 15000)

#Relación precio vs centro(km)
plot(D2$Precio ~ D2$Distance_Center, main = 'Variación del precio vs la distancia al centro')
abline(lm(D2$Precio ~ D2$Distance_Center), col = "green", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(D2$Distance_Center, D2$Precio), 2)), x = 20, y = 15000)

#Relación precio vs indice de restaurantes
plot(D2$Precio ~ D2$Ind.Restaurantes, main = 'Variación del precio vs Índice de restaurantes')
abline(lm(D2$Precio ~ D2$Ind.Restaurantes), col = "pink", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(D2$Ind.Restaurantes, D2$Precio), 2)), x = 80, y = 7000)

```
















### Atenas

```{r}

<<<<<<< HEAD
#Filtramos
D2 %>% filter(Ciudad =='Athens') -> DATHENAS
DATHENAS


#El más caro
r1 <- which.max(DATHENAS$Precio)
DATHENAS[r1,1:17]


#El más económico
r2 <- which.min(DATHENAS$Precio)
DATHENAS[r2,1:17]

#Relación precio vs metro(km)

plot(DATHENAS$Precio ~ DATHENAS$Distance_Metro, main = 'Variación del precio vs la distancia al metro')
abline(lm(DATHENAS$Precio ~ DATHENAS$Distance_Metro), col = "red", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DATHENAS$Distance_Metro, DATHENAS$Precio), 2)), x = 1.5, y = 15000)

#Relación precio vs centro(km)
plot(DATHENAS$Precio ~ DATHENAS$Distance_Center, main = 'Variación del precio vs la distancia al centro')
abline(lm(DATHENAS$Precio ~ DATHENAS$Distance_Center), col = "green", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DATHENAS$Distance_Center, DATHENAS$Precio), 2)), x = 5, y = 15000)

#Relación precio vs indice de restaurantes
plot(DATHENAS$Precio ~ DATHENAS$Ind.Restaurantes, main = 'Variación del precio vs Índice de restaurantes')
abline(lm(DATHENAS$Precio ~ DATHENAS$Ind.Restaurantes), col = "pink", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DATHENAS$Ind.Restaurantes, DATHENAS$Precio), 2)), x = 80, y = 7000)


```




### Barcelonaaa
```{r}
#Filtramos
D2 %>% filter(Ciudad =='Barcelona') -> DBARCELONA
DBARCELONA


#El más caro
r1 <- which.max(DATHENAS$Precio)
DATHENAS[r1,1:17]


#El más económico
r2 <- which.min(DATHENAS$Precio)
DATHENAS[r2,1:17]

#Relación precio vs metro(km)

plot(DATHENAS$Precio ~ DATHENAS$Distance_Metro, main = 'Variación del precio vs la distancia al metro')
abline(lm(DATHENAS$Precio ~ DATHENAS$Distance_Metro), col = "red", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DATHENAS$Distance_Metro, DATHENAS$Precio), 2)), x = 1.5, y = 15000)

#Relación precio vs centro(km)
plot(DATHENAS$Precio ~ DATHENAS$Distance_Center, main = 'Variación del precio vs la distancia al centro')
abline(lm(DATHENAS$Precio ~ DATHENAS$Distance_Center), col = "green", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DATHENAS$Distance_Center, DATHENAS$Precio), 2)), x = 5, y = 15000)

#Relación precio vs indice de restaurantes
plot(DATHENAS$Precio ~ DATHENAS$Ind.Restaurantes, main = 'Variación del precio vs Índice de restaurantes')
abline(lm(DATHENAS$Precio ~ DATHENAS$Ind.Restaurantes), col = "pink", lwd = 3, lty = 2)
text(paste("Correlación:", round(cor(DATHENAS$Ind.Restaurantes, DATHENAS$Precio), 2)), x = 80, y = 7000)


=======
>>>>>>> 16a5f065e974330ee96c535bc1a71b295f2461a0
```


### Berlín

### Roma

### Budapest

### Lisbon

### París

### Rome

### Vienna

### Filtramos a todos los más caros de su país

-   

    ```{r}
    D2 %>% group_by(Ciudad) %>% filter(Precio == max(Precio))%>% arrange(Precio)    -> D4
    D4

    ```

```{r}
barplot(table(D4$Tipo))

hist(D4$Precio)
```

### Objetivo 3 : Analizar la atracción de un Airbnb y su relación con su ubicación en ciudades de Europa del 2023

-   Analizar las ciudades con mayor indice de atracción (gráficas)

-   Analizar las ciudades con menor indice de atracción (gráficas)

-   Analizar si el indice de atracción se relaciona a un alto indice de restaurantes cercano al alojamiento o no.

-   Identificar los alojamientos de mayor cercanía al metro y su comportamiento con el índice de atracción para cada ciudad (ver si en una de ella hay correlación)

-   Identificar los alojamientos de mayor cercanía al centro y su comportamiento con el índice de atracción para cada ciudad (ver si en una de ella hay correlación)

-   Ciudad y índice de atracción por factor demográfico (ciudad):

```{r}



#Gráfico de barras apiladas: Cada barra representa una ciudad y los segmentos de cada barra representan los diferentes factores demográficos. La altura total de cada barra indicará el índice de atracción, y los segmentos dentro de cada barra mostrarán cómo se distribuye el índice de atracción entre los factores demográficos.
# Crear una tabla con las 9 ciudades

#D1<-data.frame(table(D$City))
#ciudades <- D1$Var1

TABLA_CIUDADES<-data.frame(table(D2$Ciudad))
ciudades <- TABLA_CIUDADES$Var1
ciudades

# Generar datos aleatorios para cada ciudad
#datos_al_azar <- sample(1:9, length(ciudades))

# Crear el data frame con las ciudades y los datos al azar
#datos <- data.frame(Ciudad = ciudades, IndiceAtraccion = datos_al_azar)

# Ordenar los datos por ciudad
#datos <- datos[order(datos$Ciudad), ]

# Crear la gráfica de barras
#barplot(datos$IndiceAtraccion, 
 #       names.arg = datos$Ciudad,
  #      xlab = "Ciudad",
   #     ylab = "Índice de atracción",
    #    main = "Índice de atracción por ciudad",
     #   cex.names = 0.5)

```

#### Precio e índice de atracción:

Gráfico de dispersión: Se utilizar un gráfico de dispersión donde el eje X represente el precio y el eje Y represente el índice de atracción. Cada punto en el gráfico representará una opción de alojamiento, y su posición en el gráfico mostrará cómo varía el índice de atracción en relación con el precio. Esto te permitirá identificar posibles patrones, como una mayor atracción hacia opciones de precio moderado.

```{r}
# Generar datos aleatorios para cada ciudad
# Generar datos aleatorios para cada ciudad
#D2 <- D[which(!duplicated(D$City)), ]
#D2 <- D2[sample(nrow(D2), min(200, nrow(D2)), replace = FALSE), ]

# Crear el gráfico de dispersión
#plot(D2$Price, D2$`Attraction Index`,

#     xlab = "Precio",
#     ylab = "Índice de atracción",
#     main = "Relación entre Precio e Índice de atracción")
    # xlab = "Precio",
     #ylab = "Índice de atracción",
     #main = "Relación entre Precio e Índice de atracción")

```

-   Filtrar aquellas ciudades y su valor de máxima atracción

-   Identificar su relación entre atracción e indice de restaurantes
